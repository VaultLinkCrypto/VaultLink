<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>VaultLink Admin - Live Traffic</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; padding: 30px; background: #f0f2f5; color: #1c1e21; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        th { background: #007bff; color: white; padding: 15px; text-align: left; font-size: 13px; text-transform: uppercase; }
        td { padding: 15px; border-bottom: 1px solid #eee; font-size: 14px; }
        tr:last-child td { border-bottom: none; }
        .badge { padding: 5px 10px; border-radius: 12px; font-size: 11px; font-weight: 600; text-transform: uppercase; }
        .page_view { background: #e7f3ff; color: #1877f2; }
        .copy_click { background: #e7f4e4; color: #25a115; }
        .timestamp { color: #65676b; font-family: monospace; }
    </style>
</head>
<body>

    <div class="header">
        <h2>Live Analytics Dashboard</h2>
        <div id="status">Connecting to VaultLink...</div>
    </div>

    <table>
        <thead>
            <tr>
                <th>Event Type</th>
                <th>Coin</th>
                <th>Location</th>
                <th>IP Address</th>
                <th>Timestamp (Local)</th>
            </tr>
        </thead>
        <tbody id="data-table">
            </tbody>
    </table>

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

    <script>
        // Use your existing configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAH3Ya_RPF3H5ZCI2pjPKAn5vqfPQF7BOo",
            authDomain: "vaultlinkcrypto.firebaseapp.com",
            databaseURL: "https://vaultlinkcrypto-default-rtdb.firebaseio.com",
            projectId: "vaultlinkcrypto",
            storageBucket: "vaultlinkcrypto.firebasestorage.app",
            messagingSenderId: "197889276270",
            appId: "1:197889276270:web:e74637ae83144aae5fa97f"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const tableBody = document.getElementById('data-table');

        // Reference to your 'clicks' folder
        const clicksRef = db.ref('clicks').limitToLast(100);

    clicksRef.on('child_added', (snapshot) => {
        const data = snapshot.val();
    
    // DEBUG: This tells you in the browser console exactly what the DB sent
    console.log("Raw Data from Firebase:", data);

    // 1. Resolve the Timestamp (Handle the 'undefined' issue)
    let displayDate = "N/A";
    let displayTime = "";

    // Check for your new 'timestamp' field
    if (data.timestamp) {
        const dateObj = new Date(data.timestamp);
        // Check if the date is valid
        if (!isNaN(dateObj)) {
            displayDate = dateObj.toLocaleDateString('en-US');
            displayTime = dateObj.toLocaleTimeString('en-US', { hour12: false });
        }
    } 
    // Fallback if you used 'date' and 'time' in older records
    else if (data.date) {
        displayDate = data.date;
        displayTime = data.time || "";
    }

    const row = tableBody.insertRow(0); 
    row.innerHTML = `
        <td><span class="badge ${data.event || 'default'}">${(data.event || 'view').replace('_', ' ')}</span></td>
        <td><strong>${(data.coin || 'N/A').toUpperCase()}</strong></td>
        <td>${data.location || 'Unknown'}</td>
        <td><code>${data.ip || '0.0.0.0'}</code></td>
        <td class="timestamp">${displayDate} ${displayTime}</td>
    `;
});
    </script>
</body>
</html>
