<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>VaultLink Admin - Live Traffic</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; padding: 30px; background: #f0f2f5; color: #1c1e21; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        th { background: #007bff; color: white; padding: 15px; text-align: left; font-size: 13px; text-transform: uppercase; }
        td { padding: 15px; border-bottom: 1px solid #eee; font-size: 14px; }
        tr:last-child td { border-bottom: none; }
        .badge { padding: 5px 10px; border-radius: 12px; font-size: 11px; font-weight: 600; text-transform: uppercase; }
        .page_view { background: #e7f3ff; color: #1877f2; }
        .copy_click { background: #e7f4e4; color: #25a115; }
        .timestamp { color: #65676b; font-family: monospace; }
    </style>
</head>
<body>

    <div class="header">
        <h2>Live Analytics Dashboard</h2>
        <div id="status">Connecting to VaultLink...</div>
    </div>

    <table>
        <thead>
            <tr>
                <th>User ID</th> 
                <th>Event</th>
                <th>Coin</th>
                <th>Location</th>
                <th>IP Address</th>
                <th>Timestamp</th>
            </tr>
        </thead>
        <tbody id="data-table"></tbody>
    </table>

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAH3Ya_RPF3H5ZCI2pjPKAn5vqfPQF7BOo",
            authDomain: "vaultlinkcrypto.firebaseapp.com",
            databaseURL: "https://vaultlinkcrypto-default-rtdb.firebaseio.com",
            projectId: "vaultlinkcrypto",
            storageBucket: "vaultlinkcrypto.firebasestorage.app",
            messagingSenderId: "197889276270",
            appId: "1:197889276270:web:e74637ae83144aae5fa97f"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const tableBody = document.getElementById('data-table');
        const statusMsg = document.getElementById('status');

        const clicksRef = db.ref('clicks');

        // Monitor Connection Status
        clicksRef.on('value', (snapshot) => {
            statusMsg.innerText = "Connected - Live";
            statusMsg.style.color = "green";
        }, (error) => {
            statusMsg.innerText = "Error: " + error.message;
            statusMsg.style.color = "red";
        });

        // Load and Listen for new clicks
        clicksRef.limitToLast(100).on('child_added', (snapshot) => {
            const data = snapshot.val();
            
            // Resolve Date/Time logic
            let displayDate = "N/A";
            if (data.timestamp) {
                const dateObj = new Date(data.timestamp);
                if (!isNaN(dateObj)) {
                    displayDate = dateObj.toLocaleString('en-US');
                }
            } else if (data.date) {
                displayDate = `${data.date} ${data.time || ''}`;
            }

            const row = tableBody.insertRow(0); 
            row.innerHTML = `
                <td><strong style="color:#007bff">${data.user_id || 'Legacy'}</strong></td>
                <td><span class="badge ${data.event || 'view'}">${(data.event || 'view').replace('_', ' ')}</span></td>
                <td><strong>${(data.coin || 'N/A').toUpperCase()}</strong></td>
                <td>${data.location || 'Unknown'}</td>
                <td><code>${data.ip || '0.0.0.0'}</code></td>
                <td class="timestamp">${displayDate}</td>
            `;
        });
    </script>
</body>
</html>
